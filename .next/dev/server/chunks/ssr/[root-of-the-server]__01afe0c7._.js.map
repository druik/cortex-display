{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 10, "column": 0}, "map": {"version":3,"sources":["file:///Users/Kim/Projects/cortex-display/src/lib/supabase.ts"],"sourcesContent":["import { createClient } from '@supabase/supabase-js'\n\nconst supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL!\nconst supabaseAnonKey = process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!\n\nexport const supabase = createClient(supabaseUrl, supabaseAnonKey)\n"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM;AACN,MAAM;AAEC,MAAM,WAAW,IAAA,+NAAY,EAAC,aAAa"}},
    {"offset": {"line": 23, "column": 0}, "map": {"version":3,"sources":["file:///Users/Kim/Projects/cortex-display/src/app/page.tsx"],"sourcesContent":["'use client'\n\nimport { useEffect, useState, useRef } from 'react'\nimport { supabase } from '@/lib/supabase'\n\ntype CapacityState = 'low' | 'moderate' | 'high' | 'rest'\n\ninterface Task {\n  id: string\n  title: string\n  due_date: string | null\n  is_anchor: boolean\n}\n\ninterface CalendarEvent {\n  title: string\n  start_at: string\n  provider: string\n}\n\nconst TASK_LIMITS: Record<CapacityState, number> = {\n  low: 3,\n  moderate: 5,\n  high: 7,\n  rest: 1,\n}\n\nfunction formatTime(date: Date): string {\n  return date.toLocaleTimeString('en-US', {\n    hour: 'numeric',\n    minute: '2-digit',\n    hour12: true,\n  })\n}\n\nfunction formatDate(date: Date): string {\n  return date.toLocaleDateString('en-US', {\n    weekday: 'long',\n    month: 'long',\n    day: 'numeric',\n  })\n}\n\nfunction formatCapacity(state: CapacityState): string {\n  return state.charAt(0).toUpperCase() + state.slice(1)\n}\n\nfunction formatEventTime(date: Date): string {\n  return date.toLocaleTimeString('en-US', {\n    hour: 'numeric',\n    minute: '2-digit',\n    hour12: true,\n  })\n}\n\nfunction formatRelativeTime(eventDate: Date, now: Date): string {\n  const diffMs = eventDate.getTime() - now.getTime()\n  const diffMins = Math.round(diffMs / 60000)\n  if (diffMins < 1) return 'now'\n  if (diffMins < 60) return `in ${diffMins}m`\n  const hours = Math.floor(diffMins / 60)\n  const mins = diffMins % 60\n  return mins > 0 ? `in ${hours}h ${mins}m` : `in ${hours}h`\n}\n\nexport default function CortexDisplay() {\n  const [currentTime, setCurrentTime] = useState<Date>(new Date())\n  const [capacity, setCapacity] = useState<CapacityState>('moderate')\n  const [tasks, setTasks] = useState<Task[]>([])\n  const [nextEvent, setNextEvent] = useState<CalendarEvent | null>(null)\n  const [loading, setLoading] = useState(true)\n  const [undoTask, setUndoTask] = useState<Task | null>(null)\n  const [undoTimeout, setUndoTimeout] = useState<NodeJS.Timeout | null>(null)\n  const [toast, setToast] = useState<string | null>(null)\n  const [toastExiting, setToastExiting] = useState(false)\n  const longPressTimer = useRef<NodeJS.Timeout | null>(null)\n  const isLongPress = useRef(false)\n\n  async function fetchData() {\n    const { data: capacityData } = await supabase\n      .from('Capacity')\n      .select('state')\n      .eq('id', 1)\n      .single()\n\n    if (capacityData) {\n      setCapacity(capacityData.state as CapacityState)\n    }\n\n    const today = new Date().toLocaleDateString('en-CA', { timeZone: 'America/Los_Angeles' })\n    const { data: tasksData } = await supabase\n      .from('tasks')\n      .select('id, title, due_date, is_anchor')\n      .eq('completed', false)\n      .lte('approved_date', today)\n      .order('due_date', { ascending: true, nullsFirst: false })\n\n    if (tasksData) {\n      setTasks(tasksData)\n    }\n\n    const eventRes = await fetch('/api/calendar/next')\n    const eventData = await eventRes.json()\n    setNextEvent(eventData.event || null)\n\n    setLoading(false)\n  }\n\n  async function completeTask(task: Task) {\n    if (isLongPress.current) return\n\n    setTasks(prev => prev.filter(t => t.id !== task.id))\n    setUndoTask(task)\n    setToastExiting(false)\n\n    if (undoTimeout) clearTimeout(undoTimeout)\n\n    const timeout = setTimeout(async () => {\n      await fetch('/api/tasks', {\n        method: 'PATCH',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({ id: task.id }),\n      })\n      setToastExiting(true)\n      setTimeout(() => {\n        setUndoTask(null)\n        setToastExiting(false)\n      }, 200)\n    }, 5000)\n\n    setUndoTimeout(timeout)\n  }\n\n  async function undoComplete() {\n    if (!undoTask) return\n\n    if (undoTimeout) clearTimeout(undoTimeout)\n\n    setTasks(prev => [...prev, undoTask].sort((a, b) => {\n      if (!a.due_date) return 1\n      if (!b.due_date) return -1\n      return new Date(a.due_date).getTime() - new Date(b.due_date).getTime()\n    }))\n\n    await fetch('/api/tasks', {\n      method: 'PATCH',\n      headers: { 'Content-Type': 'application/json' },\n      body: JSON.stringify({ id: undoTask.id, action: 'undo' }),\n    })\n\n    setUndoTask(null)\n    setUndoTimeout(null)\n  }\n\n  async function toggleAnchor(task: Task) {\n    const res = await fetch('/api/tasks', {\n      method: 'PATCH',\n      headers: { 'Content-Type': 'application/json' },\n      body: JSON.stringify({ id: task.id, action: 'toggle_anchor' }),\n    })\n    const data = await res.json()\n    \n    setTasks(prev => prev.map(t => \n      t.id === task.id ? { ...t, is_anchor: data.is_anchor } : t\n    ))\n    \n    setToast(data.is_anchor ? `Pinned: ${task.title}` : `Unpinned: ${task.title}`)\n    setTimeout(() => setToast(null), 2000)\n  }\n\n  function handlePressStart(task: Task) {\n    isLongPress.current = false\n    longPressTimer.current = setTimeout(() => {\n      isLongPress.current = true\n      toggleAnchor(task)\n    }, 500)\n  }\n\n  function handlePressEnd() {\n    if (longPressTimer.current) {\n      clearTimeout(longPressTimer.current)\n    }\n  }\n\n  useEffect(() => {\n    // Update clock every 30 seconds\n    const timeInterval = setInterval(() => {\n      setCurrentTime(new Date())\n    }, 30000)\n\n    // Fetch data on mount and every 30 seconds\n    fetchData()\n    const dataInterval = setInterval(fetchData, 30000)\n\n    return () => {\n      clearInterval(timeInterval)\n      clearInterval(dataInterval)\n    }\n  }, [])\n\n  const anchors = tasks.filter(t => t.is_anchor)\n  const regularTasks = tasks.filter(t => !t.is_anchor)\n  const visibleTasks = regularTasks.slice(0, TASK_LIMITS[capacity])\n\n  if (loading) {\n    return (\n      <main className=\"min-h-screen flex items-center justify-center bg-black\">\n        <p className=\"text-white/40 text-4xl\">Loading</p>\n      </main>\n    )\n  }\n\n  return (\n    <main className=\"min-h-screen flex flex-col justify-center px-16 py-20 bg-black\">\n      <p className=\"text-[12vw] font-extralight tracking-tight text-white leading-none mb-2\">\n        {formatTime(currentTime)}\n      </p>\n      <p className=\"text-[3vw] text-white/50 mb-12\">\n        {formatDate(currentTime)}\n      </p>\n      <p className=\"text-[2vw] text-white/30 mb-16\">{formatCapacity(capacity)}</p>\n\n      {/* Next Calendar Event */}\n      {nextEvent && (\n        <div className=\"mb-16 pl-6 border-l-2 border-sky-500/40\">\n          <p className=\"text-[2.5vw] text-sky-100/80\">\n            {formatEventTime(new Date(nextEvent.start_at))}\n            <span className=\"text-white/50 mx-3\">Â·</span>\n            {nextEvent.title}\n          </p>\n          <p className=\"text-[1.8vw] text-sky-400/60 mt-2 font-medium\">\n            {formatRelativeTime(new Date(nextEvent.start_at), currentTime)}\n          </p>\n        </div>\n      )}\n\n      {/* Anchored Tasks */}\n      {anchors.length > 0 && (\n        <ul className=\"space-y-6 mb-12\">\n          {anchors.map((task) => (\n            <li\n              key={task.id}\n              onClick={() => completeTask(task)}\n              onMouseDown={() => handlePressStart(task)}\n              onMouseUp={handlePressEnd}\n              onMouseLeave={handlePressEnd}\n              onTouchStart={() => handlePressStart(task)}\n              onTouchEnd={handlePressEnd}\n              className=\"text-[3vw] text-white cursor-pointer hover:text-white/60 active:text-white/40 transition-opacity select-none\"\n            >\n              ðŸ“Œ {task.title}\n            </li>\n          ))}\n        </ul>\n      )}\n\n      {/* Regular Tasks */}\n      {visibleTasks.length > 0 && (\n        <ul className=\"space-y-6\">\n          {visibleTasks.map((task) => (\n            <li\n              key={task.id}\n              onClick={() => completeTask(task)}\n              onMouseDown={() => handlePressStart(task)}\n              onMouseUp={handlePressEnd}\n              onMouseLeave={handlePressEnd}\n              onTouchStart={() => handlePressStart(task)}\n              onTouchEnd={handlePressEnd}\n              className=\"text-[3vw] text-white/70 cursor-pointer hover:text-white/40 active:text-white/20 transition-opacity select-none\"\n            >\n              {task.title}\n            </li>\n          ))}\n        </ul>\n      )}\n\n      {/* Undo Toast */}\n      {undoTask && (\n        <div className={`fixed bottom-32 left-1/2 bg-white/10 backdrop-blur-md rounded-3xl overflow-hidden ${toastExiting ? 'toast-exit' : 'toast-enter'}`}>\n          <div className=\"px-16 py-8 flex items-center gap-12\">\n            <span className=\"text-[4vw] text-white/70\">{undoTask.title}</span>\n            <button\n              onClick={undoComplete}\n              className=\"text-[4vw] text-white/50 font-medium hover:text-white transition-colors px-8 py-4 -my-4 -mr-8 min-h-[80px] min-w-[120px]\"\n            >\n              Undo\n            </button>\n          </div>\n          <div key={undoTask.id} className=\"h-2 bg-white/20 toast-progress\" />\n        </div>\n      )}\n\n      {/* Pin Toast */}\n      {toast && (\n        <div className=\"fixed bottom-12 left-1/2 -translate-x-1/2 bg-white/10 backdrop-blur px-8 py-4 rounded-full\">\n          <span className=\"text-white/70 text-xl\">{toast}</span>\n        </div>\n      )}\n    </main>\n  )\n}\n"],"names":[],"mappings":"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"}}]
}